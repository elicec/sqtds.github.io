<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>蜻蜓点水</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="蜻蜓点水">
<meta property="og:url" content="http://sqtds.github.io/categories/java/page/7/index.html">
<meta property="og:site_name" content="蜻蜓点水">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="蜻蜓点水">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="蜻蜓点水" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
  
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?1bd1f966e3148e2b59e4b159067ad372";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img lazy-src="/img/photo.jpg" class="js-avatar">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">sqtds</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/tags/随笔">随笔</a></li>
				        
							<li><a href="/about">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/sqtds" title="github">github</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
								<a class="mail" target="_blank" href="/sqtds@163.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/android/" style="font-size: 16.67px;">android</a><a href="/tags/antlr4/" style="font-size: 18.33px;">antlr4</a><a href="/tags/hadoop/" style="font-size: 11.67px;">hadoop</a><a href="/tags/impala/" style="font-size: 10px;">impala</a><a href="/tags/java核心系列/" style="font-size: 20px;">java核心系列</a><a href="/tags/java源码阅读/" style="font-size: 13.33px;">java源码阅读</a><a href="/tags/linux/" style="font-size: 15px;">linux</a><a href="/tags/linux命令/" style="font-size: 10px;">linux命令</a><a href="/tags/mondrian/" style="font-size: 18.33px;">mondrian</a><a href="/tags/netty/" style="font-size: 10px;">netty</a><a href="/tags/nosql/" style="font-size: 11.67px;">nosql</a><a href="/tags/spring/" style="font-size: 15px;">spring</a><a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a><a href="/tags/分布式/" style="font-size: 10px;">分布式</a><a href="/tags/异常/" style="font-size: 10px;">异常</a><a href="/tags/性能/" style="font-size: 10px;">性能</a><a href="/tags/数据库/" style="font-size: 15px;">数据库</a><a href="/tags/计算机原理/" style="font-size: 16.67px;">计算机原理</a><a href="/tags/随笔/" style="font-size: 10px;">随笔</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">sqtds</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/photo.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">sqtds</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags/随笔">随笔</a></li>
		        
					<li><a href="/about">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/sqtds" title="github">github</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
						<a class="mail" target="_blank" href="/sqtds@163.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-2014/antlr4-core-notation" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/08/24/2014/antlr4-core-notation/" class="article-date">
  	<time datetime="2014-08-24T10:17:27.000Z" itemprop="datePublished">8月 24 2014</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/24/2014/antlr4-core-notation/">antlr4-核心符号（二）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="符号">符号</h2><p>语言的本质都是一样的，他们都具有各种表达式。下图是antlr的作者总结的antlr的核心语法符号，大部分语言都是其中一种或者多种。<br><img src="img/2014/QQ截图20140824182207.png" alt=""></p>
<h2 id="通用语言模式">通用语言模式</h2><h3 id="序列">序列</h3><p>这是一个有限的或者循环的长序列符号或者子句。例如包含变量声明（输入在标识符后面）和整形列表。<br>下面是一些例子：</p>
<pre><code>x y ... z <span class="comment">// x followed by y, ..., z</span>
<span class="string">'['</span> <span class="keyword">INT</span>+ <span class="string">']'</span> <span class="comment">// Matlab vector of integers</span>
</code></pre><h3 id="带终止符的序列">带终止符的序列</h3><p>这是一个被符号分离的循环的序列符号或者子句。这个符号通常是分号或者新行。<br>例如python以新行结束，java以分号结束。</p>
<pre><code>(statement <span class="string">';'</span> )* <span class="comment">// Java statement list</span>
(row <span class="string">'\n'</span>)* <span class="comment">// Lines of data</span>
</code></pre><h3 id="带分离符的序列">带分离符的序列</h3><p>这是一个非空的长序列。通常被标识符，逗号，分号或者周期性的分离。</p>
<pre><code>expr (<span class="string">','</span> expr)* // <span class="function"><span class="keyword">function</span></span> <span class="keyword">call</span> arguments
( expr (<span class="string">','</span> expr)* )? // <span class="type">optional</span> <span class="function"><span class="keyword">function</span></span> <span class="keyword">call</span> arguments
<span class="string">'/'</span> ? <span class="keyword">name</span> (<span class="string">'/'</span> <span class="keyword">name</span>)* // simplified directory <span class="keyword">name</span>
stat (<span class="string">'.'</span> stat)* // SmallTalk statement list
</code></pre><h3 id="可选">可选</h3><p>这是一系列可选的短语。<br>例如包含不同种类的类型，语句，表达式，或者xml标签。</p>
<pre><code><span class="rule"><span class="attribute">type </span>:<span class="value"> <span class="string">'int'</span> | <span class="string">'float'</span> </span></span>;
<span class="rule"><span class="attribute">stat </span>:<span class="value"> ifstat | whilestat | <span class="string">'return'</span> expr <span class="string">';'</span> </span></span>;
<span class="rule"><span class="attribute">expr </span>:<span class="value"> <span class="string">'('</span> expr <span class="string">')'</span> | INT | ID </span></span>;
<span class="rule"><span class="attribute">tag </span>:<span class="value"> <span class="string">'&lt;'</span> Name attribute* <span class="string">'&gt;'</span> | <span class="string">'&lt;'</span> <span class="string">'/'</span> Name <span class="string">'&gt;'</span> </span></span>;
</code></pre><h3 id="符号依赖">符号依赖</h3><p>一个标准符的存在要求更多的标准符。<br>例如（），{}，等。</p>
<pre><code><span class="string">'('</span> expr <span class="string">')'</span> <span class="comment">// nested expression</span>
ID <span class="string">'['</span> expr <span class="string">']'</span> <span class="comment">// array index</span>
<span class="string">'{'</span> stat* <span class="string">'}'</span> <span class="comment">// statements grouped in curlies</span>
<span class="string">'&lt;'</span> ID (<span class="string">','</span> ID)* <span class="string">'&gt;'</span> <span class="comment">// generic type specifier</span>
</code></pre><h3 id="嵌套语句">嵌套语句</h3><p>这是一个自相似性的语言结构。例如表达式，嵌套java类，嵌套的代码块，和嵌套的python功能定义等。</p>
<pre><code>expr : <span class="string">'('</span> expr <span class="string">')'</span> | ID ;
classDef : <span class="string">'class'</span> ID <span class="string">'{'</span> (classDef|<span class="function"><span class="keyword">method</span>|<span class="title">field</span>) '}' ;</span>
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/antlr4/">antlr4</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/java/">java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/antlr4-start" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/08/24/2014/antlr4-start/" class="article-date">
  	<time datetime="2014-08-24T10:04:40.000Z" itemprop="datePublished">8月 24 2014</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/24/2014/antlr4-start/">antlr4快速开始（一）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="antlr是什么？">antlr是什么？</h2><p>ANTLR (ANother Tool for Language Recognition) 是一个强大的解析生成器，它可以读，处理，执行或者转换格式化的文本或者二进制文件。它被广泛的用于构建语言，工具，和框架。从语法上来说，antlr生成了一个能够构建和遍历解析树的解析器。</p>
<h2 id="快速开始">快速开始</h2><pre><code>Windows
Download http:<span class="comment">//antlr.org/download/antlr-4.4-complete.jar.</span>
<span class="keyword">Add</span> antlr4-complete.jar <span class="keyword">to</span> CLASSPATH, either:
Permanently: <span class="keyword">Using</span> System Properties dialog &gt; Environment variables &gt; <span class="keyword">Create</span> <span class="keyword">or</span> append <span class="keyword">to</span> CLASSPATH variable
Temporarily, at command line:
<span class="keyword">SET</span> CLASSPATH=.;C:\Javalib\antlr4-complete.jar;%CLASSPATH%
<span class="keyword">Create</span> batch commands <span class="keyword">for</span> ANTLR Tool, TestRig <span class="keyword">in</span> dir <span class="keyword">in</span> PATH
 antlr4.bat: java org.antlr.v4.Tool %*
 grun.bat:   java org.antlr.v4.runtime.misc.TestRig %*
</code></pre><h2 id="例子">例子</h2><pre><code><span class="tag">grammar</span> <span class="tag">Expr</span>;        
<span class="rule"><span class="attribute">prog</span>:<span class="value">    (expr NEWLINE)* </span></span>;
<span class="rule"><span class="attribute">expr</span>:<span class="value">    expr (<span class="string">'*'</span>|<span class="string">'/'</span>) expr
    |    expr (<span class="string">'+'</span>|<span class="string">'-'</span>) expr
    |    INT
    |    <span class="string">'('</span> expr <span class="string">')'</span>
    </span></span>;
<span class="rule"><span class="attribute">NEWLINE </span>:<span class="value"> [\r\n]+ </span></span>;
<span class="rule"><span class="attribute">INT     </span>:<span class="value"> [<span class="number">0</span>-<span class="number">9</span>]+ </span></span>;


$ <span class="tag">antlr4</span> <span class="tag">Expr</span><span class="class">.g4</span>
$ <span class="tag">javac</span> <span class="tag">Expr</span>*<span class="class">.java</span>
$ <span class="tag">grun</span> <span class="tag">Expr</span> <span class="tag">prog</span> <span class="tag">-gui</span>
100+2*34
^<span class="tag">D</span>
</code></pre><p><img src="http://pic.browser.360.cn/t012e3d32f2057cb701.png" alt=""></p>
<p>注意：(That ^D means EOF on unix; it’s ^Z in Windows.) The -tree option prints the parse tree in LISP notation.</p>
<p>更多请参考：<a href="https://theantlrguy.atlassian.net/wiki/display/ANTLR4/Getting+Started+with+ANTLR+v4" target="_blank" rel="external">https://theantlrguy.atlassian.net/wiki/display/ANTLR4/Getting+Started+with+ANTLR+v4</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/antlr4/">antlr4</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/java/">java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/java-jdbc" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/08/10/2014/java-jdbc/" class="article-date">
  	<time datetime="2014-08-10T09:50:39.000Z" itemprop="datePublished">8月 10 2014</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/10/2014/java-jdbc/">jdbc连接数据库一定要用Class.forName吗？</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一来源">一来源</h3><p>上周，在调试使用jdbc连接infobright的时候，遇到了一个奇怪的问题，当我使用Class.forName加载myslq jdbc的驱动的进行连接数据库的时候，连接缺报异常了。奇怪的是异常信息并不是mysql驱动抛出来的，而是另一个数据库驱动，达梦的驱动异常。</p>
<h3 id="二好奇心">二好奇心</h3><p>为什么会这样呢，我明明没有加载达梦的数据集驱动呀？连不上也就算了，还抛了个其他的异常，百思不得其解。于是，我debug到了DriverManager中的源码看了看，发现已经加载了各种不同的jdbc驱动有6,7种之多。就这样，顺带的，我凑了眼DriverManager的源码。<br>
      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java源码阅读/">java源码阅读</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/java/">java</a>
	</div>


      
        <p class="article-more-link">
          <a  href="/2014/08/10/2014/java-jdbc/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/java-int" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/08/09/2014/java-int/" class="article-date">
  	<time datetime="2014-08-09T07:30:12.000Z" itemprop="datePublished">8月 9 2014</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/09/2014/java-int/">int源码赏析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概要">概要</h3><p>今天突发好奇，想不明白string是如何转换为int的，于是翻开jdk的源码，收货挺大的。</p>
<h3 id="parseInt(String_s)">parseInt(String s)</h3><p>首先我们看parseInt这个方法，看下图，它又调用了parseInt(String s, int radix)，这个方法才是String转换成int的主要过程。这个方法比较有趣，我们来一一分析它的实现机制。</p>
<pre><code>public <span class="keyword">static</span> <span class="type">int</span> parseInt(<span class="type">String</span> s) throws <span class="type">NumberFormatException</span> {
        //此处表示s默认为<span class="number">10</span>进制
        <span class="keyword">return</span> parseInt(s,<span class="number">10</span>);
}

//radix为s的进制格式，不能大于<span class="number">36</span>也不能小于<span class="number">2</span>，即最小为<span class="number">2</span>进制，最大为<span class="number">36</span>进制，<span class="number">36</span>进制的得来是<span class="number">10</span>个数字加<span class="number">26</span>个字母
//例如，parseInt(<span class="string">"Kona"</span>, <span class="number">27</span>) returns <span class="number">411787</span>
public <span class="keyword">static</span> <span class="type">int</span> parseInt(<span class="type">String</span> s, <span class="type">int</span> radix)
            throws <span class="type">NumberFormatException</span>
{
    /*
     * <span class="type">WARNING</span>: <span class="type">This</span> <span class="keyword">method</span> may be invoked early during <span class="type">VM</span> initialization
     * before <span class="type">IntegerCache</span> <span class="keyword">is</span> initialized. <span class="type">Care</span> must be taken to <span class="keyword">not</span> use
     * the valueOf <span class="keyword">method</span>.
     */

    <span class="keyword">if</span> (s == null) {
        throw new <span class="type">NumberFormatException</span>(<span class="string">"null"</span>);
    }

    <span class="keyword">if</span> (radix &lt; <span class="type">Character</span>.<span class="type">MIN_RADIX</span>) {
        throw new <span class="type">NumberFormatException</span>(<span class="string">"radix "</span> + radix +
                                        <span class="string">" less than Character.MIN_RADIX"</span>);
    }

    <span class="keyword">if</span> (radix &gt; <span class="type">Character</span>.<span class="type">MAX_RADIX</span>) {
        throw new <span class="type">NumberFormatException</span>(<span class="string">"radix "</span> + radix +
                                        <span class="string">" greater than Character.MAX_RADIX"</span>);
    }

    <span class="type">int</span> <span class="literal">result</span> = <span class="number">0</span>;
    boolean negative = <span class="literal">false</span>;
    <span class="type">int</span> i = <span class="number">0</span>, len = s.length();
    //统一转成负号进行处理，不会出现溢出现象
    <span class="type">int</span> limit = -<span class="type">Integer</span>.<span class="type">MAX_VALUE</span>;
    <span class="type">int</span> multmin;
    <span class="type">int</span> digit;

    <span class="keyword">if</span> (len &gt; <span class="number">0</span>) {
        <span class="type">char</span> firstChar = s.charAt(<span class="number">0</span>);
        <span class="keyword">if</span> (firstChar &lt; '<span class="number">0</span>') { // <span class="type">Possible</span> leading <span class="string">"+"</span> <span class="keyword">or</span> <span class="string">"-"</span>
            <span class="keyword">if</span> (firstChar == '-') {
                negative = <span class="literal">true</span>;
                limit = <span class="type">Integer</span>.<span class="type">MIN_VALUE</span>;
            } <span class="keyword">else</span> <span class="keyword">if</span> (firstChar != '+')
                throw <span class="type">NumberFormatException</span>.forInputString(s);

            <span class="keyword">if</span> (len == <span class="number">1</span>) // <span class="type">Cannot</span> have lone <span class="string">"+"</span> <span class="keyword">or</span> <span class="string">"-"</span>
                throw <span class="type">NumberFormatException</span>.forInputString(s);
            i++;
        }
        multmin = limit / radix;
        <span class="keyword">while</span> (i &lt; len) {
            // <span class="type">Accumulating</span> negatively avoids surprises near <span class="type">MAX_VALUE</span>
            //拿到第i个数字并且格式化成<span class="number">10</span>进制
            digit = <span class="type">Character</span>.digit(s.charAt(i++),radix);
            <span class="keyword">if</span> (digit &lt; <span class="number">0</span>) {
                throw <span class="type">NumberFormatException</span>.forInputString(s);
            }
            <span class="keyword">if</span> (<span class="literal">result</span> &lt; multmin) {
                throw <span class="type">NumberFormatException</span>.forInputString(s);
            }
            <span class="literal">result</span> *= radix;
            <span class="keyword">if</span> (<span class="literal">result</span> &lt; limit + digit) {
                throw <span class="type">NumberFormatException</span>.forInputString(s);
            }
            //使用负号进行计算 , -<span class="number">20</span>-<span class="number">3</span>=-<span class="number">23</span>
            <span class="literal">result</span> -= digit;
        }
    } <span class="keyword">else</span> {
        throw <span class="type">NumberFormatException</span>.forInputString(s);
    }
    <span class="keyword">return</span> negative ? <span class="literal">result</span> : -<span class="literal">result</span>;
}
</code></pre><hr>
<h3 id="Integer_decode(String_nm)">Integer decode(String nm)</h3><p>转换8进制，16进制，10进制到10进制</p>
<pre><code>public <span class="keyword">static</span> <span class="type">Integer</span> decode(<span class="type">String</span> nm) throws <span class="type">NumberFormatException</span> {
    <span class="type">int</span> radix = <span class="number">10</span>;
    <span class="type">int</span> index = <span class="number">0</span>;
    boolean negative = <span class="literal">false</span>;
    <span class="type">Integer</span> <span class="literal">result</span>;

    <span class="keyword">if</span> (nm.length() == <span class="number">0</span>)
        throw new <span class="type">NumberFormatException</span>(<span class="string">"Zero length string"</span>);
    <span class="type">char</span> firstChar = nm.charAt(<span class="number">0</span>);
    // <span class="type">Handle</span> sign, <span class="keyword">if</span> present
    <span class="keyword">if</span> (firstChar == '-') {
        negative = <span class="literal">true</span>;
        index++;
    } <span class="keyword">else</span> <span class="keyword">if</span> (firstChar == '+')
        index++;

    // <span class="type">Handle</span> radix specifier, <span class="keyword">if</span> present
    <span class="keyword">if</span> (nm.startsWith(<span class="string">"0x"</span>, index) || nm.startsWith(<span class="string">"0X"</span>, index)) {
        index += <span class="number">2</span>;
        radix = <span class="number">16</span>;
    }
    <span class="keyword">else</span> <span class="keyword">if</span> (nm.startsWith(<span class="string">"#"</span>, index)) {
        index ++;
        radix = <span class="number">16</span>;
    }
    <span class="keyword">else</span> <span class="keyword">if</span> (nm.startsWith(<span class="string">"0"</span>, index) &amp;&amp; nm.length() &gt; <span class="number">1</span> + index) {
        index ++;
        radix = <span class="number">8</span>;
    }

    <span class="keyword">if</span> (nm.startsWith(<span class="string">"-"</span>, index) || nm.startsWith(<span class="string">"+"</span>, index))
        throw new <span class="type">NumberFormatException</span>(<span class="string">"Sign character in wrong position"</span>);

    <span class="keyword">try</span> {
        <span class="literal">result</span> = <span class="type">Integer</span>.valueOf(nm.substring(index), radix);
        <span class="literal">result</span> = negative ? <span class="type">Integer</span>.valueOf(-<span class="literal">result</span>.intValue()) : <span class="literal">result</span>;
    } catch (<span class="type">NumberFormatException</span> e) {
        // <span class="type">If</span> number <span class="keyword">is</span> <span class="type">Integer</span>.<span class="type">MIN_VALUE</span>, we'll <span class="keyword">end</span> up here. <span class="type">The</span> next line
        // handles this <span class="keyword">case</span>, <span class="keyword">and</span> causes <span class="type">any</span> genuine format error to be
        // rethrown.
        <span class="type">String</span> constant = negative ? (<span class="string">"-"</span> + nm.substring(index))
                                   : nm.substring(index);
        <span class="literal">result</span> = <span class="type">Integer</span>.valueOf(constant, radix);
    }
    <span class="keyword">return</span> <span class="literal">result</span>;
}
</code></pre><h3 id="String_toString(int_i,_int_radix)">String toString(int i, int radix)</h3><pre><code><span class="keyword">public</span> static String toString(<span class="built_in">int</span> i, <span class="built_in">int</span> <span class="built_in">radix</span>) {

    <span class="keyword">if</span> (<span class="built_in">radix</span> &lt; <span class="type">Character</span>.MIN_RADIX || <span class="built_in">radix</span> &gt; <span class="type">Character</span>.MAX_RADIX)
        <span class="built_in">radix</span> = <span class="number">10</span>;

    /* <span class="keyword">Use</span> the faster version */
    <span class="keyword">if</span> (<span class="built_in">radix</span> == <span class="number">10</span>) {
        <span class="keyword">return</span> toString(i);
    }

    <span class="built_in">char</span> buf[] = new <span class="built_in">char</span>[<span class="number">33</span>];
    boolean negative = (i &lt; <span class="number">0</span>);
    <span class="built_in">int</span> charPos = <span class="number">32</span>;

    //如果非负数，转成负数
    <span class="keyword">if</span> (<span class="comment">!negative) {</span>
        i = -i;
    }

    /**  <span class="number">12</span>|<span class="number">2</span> ..<span class="number">.0</span>
    *     <span class="number">6</span>|<span class="number">2</span> ..<span class="number">.0</span>
    *     <span class="number">3</span>|<span class="number">2</span> ..<span class="number">.1</span>
    *     <span class="number">1</span>|<span class="number">2</span> ..<span class="number">.1</span>      
    *    类似这种除法...
     **/
    <span class="keyword">while</span> (i &lt;= -<span class="built_in">radix</span>) {
        buf[charPos--] = <span class="built_in">digits</span>[-(i % <span class="built_in">radix</span>)];
        i = i / <span class="built_in">radix</span>;
    }
    buf[charPos] = <span class="built_in">digits</span>[-i];

    <span class="keyword">if</span> (negative) {
        buf[--charPos] = <span class="string">'-'</span>;
    }

    <span class="keyword">return</span> new String(buf, charPos, (<span class="number">33</span> - charPos));
}
</code></pre><hr>
<h3 id="Integer_valueOf(String_s)">Integer valueOf(String s)</h3><p>valueOf有点特殊，他缓存了-128到127的值，所以数字在此范围内都是取的同一个对象。<br>与其类似的还有</p>
<ul>
<li>Boolean：(全部缓存)</li>
<li>Byte：(全部缓存)</li>
<li>Character(&lt;= 127缓存)</li>
<li>Short(-128 — 127缓存)</li>
<li>Integer(-128 — 127缓存)</li>
<li>Long(-128 — 127缓存)</li>
<li>Float(没有缓存)</li>
<li>Doulbe(没有缓存)</li>
</ul>
<pre><code><span class="keyword">public</span> <span class="keyword">static</span> <span class="function">Integer <span class="title">valueOf</span><span class="params">(String s)</span> <span class="keyword">throws</span> NumberFormatException </span>{
    <span class="keyword">return</span> Integer.valueOf(parseInt(s, <span class="number">10</span>));
}

<span class="keyword">public</span> <span class="keyword">static</span> <span class="function">Integer <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>{
    <span class="keyword">assert</span> IntegerCache.high &gt;= <span class="number">127</span>;
    <span class="keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)
        <span class="keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];
    <span class="keyword">return</span> <span class="keyword">new</span> Integer(i);
}
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java源码阅读/">java源码阅读</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/java/">java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/spring-tx3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/06/09/2014/spring-tx3/" class="article-date">
  	<time datetime="2014-06-09T14:40:09.000Z" itemprop="datePublished">6月 9 2014</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/09/2014/spring-tx3/">spring事务原理3-事务的传播行为</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="事务的传播行为">事务的传播行为</h3><p>在spring管理的事务中，需要认识到物理和逻辑事务的不同，并且如何设置这些不同。</p>
<ul>
<li>PROPAGATION_REQUIRED</li>
</ul>
<p>如果当前存在一个事务，则加入当前事务。如果不存在任何事务，则创建一个新的事务。总之，要至少保证在一个事务中运行。PROPAGATION_REQUIRED通常作为默认的事务传播行为。<br><img src="/img/2014/QQ图片20140609223017.jpg" alt=""></p>
<ul>
<li>PROPAGATION_SUPPORTS</li>
</ul>
<p>如果当前存在一个事务，则加入当前事务。如果当前不存在事务，则直接执行。对于一些查询方法来说，PROPAGATION_SUPPORTS通常是比较合适的传播行为选择。</p>
<ul>
<li>PROPAGATION_MANDATORY </li>
</ul>
<p>PROPAGATION_MANDATORY 强制要求当前存在一个事务，如果不存在，则抛出异常.</p>
<ul>
<li>PROPAGATION_REQUIRES_NEW</li>
</ul>
<p>不管当前是否存在事务，都会创建新的事务。如果当前存在事务，会将当前的事务挂起（Suspend）。如果某个业务对象所做的事情不想影响到外层事务，PROPAGATION_REQUIRES_NEW 应该是合适的选择。比如，假设当前的业务方法需要向数据库中更新某些日志信息，但即使这些日志信息更新失败，我们也不想因为该业务方法的事务回滚，而影响到外层事务的成功提交。因为这种情况下，当前业务方法的事务成功与否对外层事务来说是无关紧要的。<br><img src="/img/2014/QQ图片20140609223105.jpg" alt=""></p>
<ul>
<li>PROPAGATION_NOT_SUPPORTED</li>
</ul>
<p>不支持当前事务，而是在没有事务的情况下执行。如果当前存在事务的话，当前事务原则上将被挂起（Suspend）.</p>
<ul>
<li>PROPAGATION_NEVER</li>
</ul>
<p>永远不需要当前存在事务，如果存在当前事务，则抛出异常。 </p>
<ul>
<li>PROPAGATION_NESTED</li>
</ul>
<p>如果存在当前事务，则在当前事务的一个嵌套事务中执行，否则与PROPAGATION_REQUIRED 的行为类似，即创建新的事务，在新创建的事务中执行.<br><img src="/img/2014/QQ图片20140609223801.jpg" alt=""></p>
<p>PROPAGATION_NESTED事务是依赖的吧，不可分割的，PROPAGATION_REQUIRES_NEW是独立的，相互分离的。</p>
<p>PROPAGATION_NESTED uses a single physical transaction with multiple savepoints that it can roll back to. Such partial rollbacks allow an inner transaction scope to trigger a rollback for its scope, with the outer transaction being able to continue the physical transaction despite some operations having been rolled back. This setting is typically mapped onto JDBC savepoints, so will only work with JDBC resource transactions. See Spring’s DataSourceTransactionManager.</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/java/">java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/spring-tx2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/06/09/2014/spring-tx2/" class="article-date">
  	<time datetime="2014-06-09T14:40:09.000Z" itemprop="datePublished">6月 9 2014</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/09/2014/spring-tx2/">spring事务原理2-隔离级别</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>spring提供了5种事务的隔离级别：</p>
<h3 id="ISOLATION_DEFAULT">ISOLATION_DEFAULT</h3><p>如果指定隔离级别为ISOLATION_DEFAULT ，则表示使用数据库默认的隔离级别，通常情况下是Read Committed 。</p>
<h3 id="ISOLATION_READ_UNCOMMITTED">ISOLATION_READ_UNCOMMITTED</h3><p>对应Read Uncommitted 隔离级别，无法避免脏读，不可重复读和幻读。</p>
<h3 id="ISOLATION_READ_COMMITTED">ISOLATION_READ_COMMITTED</h3><p>对应Read Committed 隔离级别，可以避免脏读，但无法避免不可重复读和幻读。</p>
<h3 id="ISOLATION_REPEATABLE_READ">ISOLATION_REPEATABLE_READ</h3><p>对应Repeatable read隔离级别，可以避免脏读和不可重复读，但不能避免幻读.</p>
<h3 id="ISOLATION_SERIALIZABLE">ISOLATION_SERIALIZABLE</h3><p>对应Serializable 隔离级别，可以避免所有的脏读，不可重复读以及幻读，但并发性效率最低.</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/java/">java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/categories/java/page/6/">&laquo; Prev</a><a class="page-number" href="/categories/java/">1</a><span class="space">&hellip;</span><a class="page-number" href="/categories/java/page/5/">5</a><a class="page-number" href="/categories/java/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/categories/java/page/8/">8</a><a class="extend next" rel="next" href="/categories/java/page/8/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 sqtds
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/mobile.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>





<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div>
</body>
</html>